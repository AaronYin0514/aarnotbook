
# 图像分类框架

## 分类网络的基本结构

![](tupfenlei.png)

## 数据加载

- RGB数据 OR BGR数据
- JPEG编码后的数据
- `torchvision.datasets`中的数据集
- `torch.utils.data`下的Dataset，DataLoader自定义数据集

## 数据增强

```
torchvision.transforms

train_transforms = transforms.Compose([
	transforms.RandomResizedCrop((227,227)),
	transforms.ToTensor(),
])
```

## 网络结构

![](../assets/imgs/pytorch/wangluojiegou.png)

## 类别概率分布

- N维度向量对应N个分类
- 如何将卷积输出的tensor转换成N维向量？
	- FC
	- Conv
	- pooling
- Softmax

$$
S_i = \frac {e^i} {\sum_j {e^j}}
$$

## Loss

- `nn.CrossEntropyLoss`: one-hot编码
- label smoothing：

$$
q_i =

\begin{cases}

1 - \varepsilon, & \text{if} & i = y\\
\varepsilon / (K - 1),& \text{otherwise}

\end{cases}
$$

## 分类问题常用评价指标

|          | 预测值=1 | 预测值=0 |
| -------- | -------- | -------- |
| 真实值=1 | TP       | FN       |
| 真实值=0 | FP       | TN       |

- **正确率（accuracy）**：$(TP + TN) / (P + N)$
- **错误率（error rate）**：$(FP + FN) / (P + N)$
- **灵敏度（sensitive）**：$sensitive = TP / P$
- **特效度（specificity）**：$TN/N$
- **精度（precision）**：$TP / (TP + FP)$
- **召回率（recall）**：$TP/(TP + FN)=TP/P=sensitive$

### PR曲线

![](pr.png)

### ROC曲线/AUC面积

- $TPR = TP / (TP + FN)$
- $FPR = FP / (FP + TN)$

![](rocauc.png)


## 优化器选择

- 推荐使用：`torch.optim.Adam`
- 学习率初始值：lr=0.001
- 学习率指数衰减：`torch.optim.lr_scheduler.ExponentialLR`


