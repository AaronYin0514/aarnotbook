---
tags: python ai pytorch 
---

# 张量-索引与数据筛选

## 函数

| 函数                                              | 说明                                           |
| ------------------------------------------------- | ---------------------------------------------- |
| `torch.where(condition, x, y)`                    | 按条件从x和y中选出满足条件的元素组成新的tensor |
| `torch.gather(input, dim, index, out=None)`       | 在指定维度上按照索引赋值输出tensor             |
| `torch.index_select(input, dim, index, out=None)` | 按照指定索引输出tensor                         |
| `torch.masked_select(input, mask, out=None)`      | 按照mask输出tensor，输出为向量                 |
| `torch.take(input, indices)`                      | 将输入看成1D-tensor，按照索引得到输出tensor    |
| `torch.nonzero(input, out=None)`                  | 输出非0元素的坐标                              |

## 实例

**where**

按条件从x和y中选出满足条件的元素组成新的tensor

```python
a = torch.rand(4, 4) # tensor([[0.1807, 0.3660],[0.8439, 0.7603]])
b = torch.rand(4, 4) # tensor([[0.6962, 0.4815],[0.1468, 0.0850]])

out = torch.where(a > 0.5, a, b) # tensor([[0.6962, 0.4815],[0.8439, 0.7603]])

# 说明
# 在a，b中选择满足条件的元素组成新tensor
```

**gather**

在指定维度上按照索引赋值输出tensor

```python
import torch

a = torch.linspace(1, 16, 16).view(4, 4)
'''
tensor([[ 1.,  2.,  3.,  4.],
        [ 5.,  6.,  7.,  8.],
        [ 9., 10., 11., 12.],
        [13., 14., 15., 16.]])
'''

out = torch.gather(a, dim=0, index=torch.tensor([[0, 1, 1, 1],
												 [0, 1, 2, 2],
												 [0, 1, 3, 3]]))
'''
tensor([[ 1.,  6.,  7.,  8.],
        [ 1.,  6., 11., 12.],
        [ 1.,  6., 15., 16.]])
'''

# 解释
# dim=0 按列筛选
# 索引为
# 0, 1, 1, 1
# 0, 1, 2, 2
# 0, 1, 3, 3
# out第一列 取a第一列[1, 5, 9, 13]的[0, 0, 0]元素，即[1, 1, 1]
# out第三列 取a第三列[3, 7, 11, 15]的[1, 2, 3]元素，即[7, 11, 15]
# 依此类推...
```

**index_select**

按照指定索引输出tensor

```python
import torch

a = torch.rand(4, 4)
'''
tensor([[0.0935, 0.5597, 0.4949, 0.0293],
        [0.3513, 0.0853, 0.3995, 0.1559],
        [0.2483, 0.6850, 0.6010, 0.9081],
        [0.0759, 0.8711, 0.3150, 0.6423]])
'''

out = torch.index_select(a, dim=0, index=torch.tensor([0, 3, 2]))
'''
tensor([[0.0935, 0.5597, 0.4949, 0.0293],
        [0.0759, 0.8711, 0.3150, 0.6423],
        [0.2483, 0.6850, 0.6010, 0.9081]]) torch.Size([3, 4])
'''

# 解释
# dim=0 按列筛选
# 索引为 [0, 3, 2]
# 取a第一列 分别 a_01 a_31 a_21 元素 所以结果为
# out第一列 0.0935 0.0759 0.2483
# 依此类推...
```

**masked_select**

按照mask输出tensor，输出为向量

```python
import torch

a = torch.linspace(1, 16, 16).view(4, 4)
'''
tensor([[ 1.,  2.,  3.,  4.],
        [ 5.,  6.,  7.,  8.],
        [ 9., 10., 11., 12.],
        [13., 14., 15., 16.]])
'''

mask = torch.gt(a, 8)
'''
tensor([[False, False, False, False],
        [False, False, False, False],
        [ True,  True,  True,  True],
        [ True,  True,  True,  True]])
'''

out = torch.masked_select(a, mask)
# tensor([ 9., 10., 11., 12., 13., 14., 15., 16.])

# 解释
# 选择大于8的元素，组成向量
```

**take**

将输入看成1D-tensor，按照索引得到输出tensor

```python
import torch

a = torch.linspace(1, 16, 16).view(4, 4)
b = torch.take(a, index=torch.tensor([0,15,13,10]))
```

**nonzero**

输出非0元素的坐标

```python
import torch

a = torch.tensor([[0, 1, 2, 0], [2, 3, 0, 1]])
out = torch.nonzero(a)
'''
tensor([[0, 1],
        [0, 2],
        [1, 0],
        [1, 1],
        [1, 3]])
'''
```



