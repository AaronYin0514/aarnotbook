---
tags: python ai pytorch 
---

# 张量-组合拼接复制

## `torch.cat`

`torch.cat` 是用于（沿指定的维度）连接多个张量的函数。所有输入张量必须具有相同的形状，除了连接的维度。

**函数签名**

```python
torch.cat(tensors, dim=0, out=None)
```

**参数**

  - `tensors`: 要连接的张量序列，可以是列表或元组。
  - `dim`: 指定连接的维度，默认为0。
  - `out` (可选): 用于存储结果的张量。

**示例**

基本用法

```python
import torch

# 创建几个张量
a = torch.tensor([[1, 2], [3, 4]])
b = torch.tensor([[5, 6]])

# 沿着第0维连接
result_dim0 = torch.cat((a, b), dim=0)

# 沿着第1维连接
c = torch.tensor([[7], [8]])
result_dim1 = torch.cat((a, c), dim=1)

print("Result along dim 0:\n", result_dim0)
# 输出:
# tensor([[1, 2],
#         [3, 4],
#         [5, 6]])

print("Result along dim 1:\n", result_dim1)
# 输出:
# tensor([[1, 2, 7],
#         [3, 4, 8]])
```

## `torch.stack`

用于将多个张量沿着一个**新维度**进行连接的函数。所有输入张量必须具有相同的形状。

`torch.stack` 与 `torch.cat` 的区别， `torch.stack` 会在指定维度上增加一个新的维度，而 `torch.cat` 则是在已有维度上进行连接，不会增加新维度。

**函数签名**

```python
torch.stack(tensors, dim=0)
```

**参数**

  - `tensors`: 要连接的张量序列，可以是列表或元组。
  - `dim`: 指定插入新维度的位置，默认为0。

**示例**

1. 基本用法

```python
import torch

# 创建几个一维张量
a = torch.tensor([1, 2, 3])
b = torch.tensor([4, 5, 6])
c = torch.tensor([7, 8, 9])

# 使用 torch.stack 连接张量
stacked_tensor = torch.stack([a, b, c])

print("Stacked tensor:\n", stacked_tensor)
# 输出:
# tensor([[1, 2, 3],
#         [4, 5, 6],
#         [7, 8, 9]])
```

2. 指定维度

```python
# 沿着不同的维度进行堆叠
stacked_dim0 = torch.stack([a, b], dim=0)  # 在第0维堆叠
stacked_dim1 = torch.stack([a, b], dim=1)  # 在第1维堆叠

print("Stacked along dim 0:\n", stacked_dim0)
# 输出:
# tensor([[1, 2, 3],
#         [4, 5, 6]])

print("Stacked along dim 1:\n", stacked_dim1)
# 输出:
# tensor([[1, 4],
#         [2, 5],
#         [3, 6]])
```


## `torch.repeat_interleave`

用于沿指定维度重复张量中的元素。这个函数可以根据指定的次数来复制每个元素，生成一个新的张量。

**函数签名**

```python
torch.repeat_interleave(input, repeats, dim=None, output_size=None)
```

**参数说明**

- **input**: 输入张量。
- **repeats**: 表示每个元素需要重复的次数。可以是一个整数或一个与输入张量在指定维度上长度相同的张量/列表。
- **dim**: 指定沿哪个维度重复元素。如果不指定，输入张量将被展平（flatten）并沿展平后的维度进行重复。
- **output_size**: 可选参数，用于指定输出张量的大小。如果指定，该大小将用于计算输出张量的维度。

**返回值**

返回一个新的张量，其中每个元素按照 `repeats` 指定的次数重复。

**示例**

1. 沿指定维度重复元素

```python
import torch

# 创建一个 1D 张量
x = torch.tensor([1, 2, 3])
# 沿着张量展开的维度，每个元素重复 2 次
result = torch.repeat_interleave(x, repeats=2)
print(result)  # 输出: tensor([1, 1, 2, 2, 3, 3])
```

2. 沿指定维度重复元素（2D 张量）

```python
import torch

# 创建一个 2D 张量
x = torch.tensor([[1, 2], [3, 4]])
# 沿着第 0 维（行）重复每个元素 2 次
result = torch.repeat_interleave(x, repeats=2, dim=0)
print(result)
# 输出:
# tensor([[1, 2],
#         [1, 2],
#         [3, 4],
#         [3, 4]])

# 沿着第 1 维（列）重复每个元素 2 次
result = torch.repeat_interleave(x, repeats=2, dim=1)
print(result)
# 输出:
# tensor([[1, 1, 2, 2],
#         [3, 3, 4, 4]])
```

3. 不同元素有不同的重复次数

```python
import torch

# 创建一个 1D 张量
x = torch.tensor([1, 2, 3])
# 使用一个列表来指定每个元素的重复次数
result = torch.repeat_interleave(x, repeats=[1, 2, 3])
print(result)  # 输出: tensor([1, 2, 2, 3, 3, 3])
```

**总结**

`torch.repeat_interleave` 是一个强大的函数，用于根据指定的重复次数扩展张量中的元素。它可以用于数据预处理、数据扩展以及某些需要重复数据的操作。


