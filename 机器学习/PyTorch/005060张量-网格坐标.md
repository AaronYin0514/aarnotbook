# 网格坐标`meshgrid`

## 图像坐标

图像坐标的原点是左上角、x轴是宽、指向右；y轴是高、指向下

![](2255819-20230125211647375-620451720.png)

## 网格

```python
feat = torch.randn(3, 4, 6) hsize, wsize = feat.shape[-2:] 
# tensor的shape一般都是（..., h, w）。
# 要注意使用(x, y)时，坐标的对应关系，x对应的是w、y对应的是h
yv, xv = torch.meshgrid([torch.arange(hsize), torch.arange(wsize)], indexing="ij")
grids = torch.stack((xv, yv), 2)
```

通过`torch.meshgrid()`生成了`yv`和`xv`，其内容如下：

```
# yv tensor([[0, 0, 0, 0, 0, 0], 
#            [1, 1, 1, 1, 1, 1], 
#            [2, 2, 2, 2, 2, 2],
#            [3, 3, 3, 3, 3, 3]])
#
# (hsize, wsize)

# xv tensor([[0, 1, 2, 3, 4, 5],
#            [0, 1, 2, 3, 4, 5],
#            [0, 1, 2, 3, 4, 5],
#            [0, 1, 2, 3, 4, 5]])
#
# (hsize, wsize)
```

然后通过`torch.stack()`将生成的`xv`与`yv`组合起来，就得到了grid网格坐标。

```
# tensor([[[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0]],
#         [[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1]],
#         [[0, 2], [1, 2], ...
#                          [2, 3], [3, 3], [4, 3], [5, 3]]
#        ])
#
# (hsize, wsize, 2)
```

