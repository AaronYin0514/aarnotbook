# static和extern关键字2-对变量的作用

上一讲介绍了[static和extern对函数的作用](http://www.cnblogs.com/mjios/archive/2013/03/21/2974181.html)，static用来定义一个内部函数，不允许其他文件访问；extern用来定义和声明一个外部函数，允许其他文件访问。static和extern对变量也有作用，不过跟函数有点差别。

C语言和Java都有全局变量的概念，但是它们的用法还是有些差别的。

## 一、在Java中，全局变量的定义没有严格的位置规定

全局变量可以定义在类的最前面，也可以定义在类的最尾端，也就说一个方法可以访问在它之后定义的变量。

```java
public class Test {

  public void test() {
    a = 10;
  }

  int a;
}
```

可以看到，test方法可以访问第8行定义的变量a，这是完全没有问题的。

## 二、在C语言中，全局变量定义的位置是有限制的

默认情况下，一个函数不可以访问在它后面定义的全局变量

```c
int main() {
  a = 10;
  return 0;
}

int a;
```

在main函数中尝试访问第9行定义的变量a，编译器直接报错了。

解决这个错误的话，有2种办法：

### 第1种办法：将变量a定义在main函数的前面

![](https://images0.cnblogs.com/blog/497279/201303/22215007-def9769226944c4da1b20f3c106998d3.png)

这样做编译器就不会找你麻烦了。

### 第2种办法：在main函数前面对变量a进行提前声明

也就是让main函数知道变量a的存在就行了，至于变量a定义在哪个位置，main函数不用管。

* 完整的变量声明需要用extern关键字

![](https://images0.cnblogs.com/blog/497279/201303/22220230-9ffb346224c94744ab3e1564192ad1c2.png)

第3行是对变量a进行声明，第10行是定义变量a，再次强调，声明和定义是两码事。在第6行操作的就是第10行定义的变量a。

> 注意：你不能省略第10行的定义，只留下第3行的声明，因为extern是用来声明一个已经定义过的变量。

## 三、重复定义同一个变量

* 其实，你也可以直接在main函数前面再定义一次a

![](https://images0.cnblogs.com/blog/497279/201303/22221156-cb15305d142d46a8957fea123b9a49bd.png)

看到这一幕，你可能很惊讶，但编译器是不会报错的。在这种情况下，第3行和第10行的变量a代表着同一个变量。

* 以此类推，如果我们写了无数遍全局变量int a;，它们代表的都是同一个变量（因为Xcode的编译器自动在其他的int a前面都加了一个extern关键字，相当于是extern int a。只留一下一个int a用来定义变量a，其他都是在引用变量a）。

![](https://images0.cnblogs.com/blog/497279/201303/22222144-a09f3daf1d12450a8bdf56dd4d37667e.png)第3到第6行、第13到第17行的变量a都代表着同一个变量。  

* 还要注意的一点是，我们也可以将全局变量a声明为局部变量后再使用！！！

![](https://images0.cnblogs.com/blog/497279/201303/22222551-e66c6b0dd75945d796664485085d18e1.png)

注意：第2、第5、第6、第10行都代表着同一个变量。其实，从第6行a的颜色\(浅蓝色\)都可以看出，这个a依然是个全局变量。

(这是Xcode的特性，如果在函数内部访问了全局变量，全局变量就会显示浅蓝色，如果函数内部访问的是局部变量，局部变量就显示普通的黑色。当然，不同的开发工具有不同的显示方案)

* 但是，如果你将第5行的extern去掉，那情况就完全不一样了，相信有编程经验的你都懂得这是什么情况了

![](https://images0.cnblogs.com/blog/497279/201303/22223005-fee76d92055848598f79ca7789eb9223.png)

第2、第10行代表着同一个全局变量，而第5、第6行则是一个局部变量，跟外面的那个全局变量没有半毛钱的关系。其实从第5、6行a的颜色(黑色)都可以看出是个局部变量。

## 四、不同源文件中的同名变量

前面讲到，你在一个源文件中无论写多少遍全局变量int a;，它们代表的都是同一个变量。还有一个事实，假如在另一个源文件中也有全局变量int a;，那么这两个源文件的所有全局变量int a;都代表着同一个变量。extern关键字还是适用的，比如:

![](https://images0.cnblogs.com/blog/497279/201303/23083426-bda17b35f43e4711b8b09b17d286bc1b.png)

![](https://images0.cnblogs.com/blog/497279/201303/23084023-bd4bfe7d6d434398a0b0b0efadf75d6a.png)  

或者是:

![](https://images0.cnblogs.com/blog/497279/201303/23083521-90ee16150a9d435a82dbed760fe837a8.png)

![](https://images0.cnblogs.com/blog/497279/201303/23084031-df38405c7291421f9cc76a0dc3da47c0.png)

上面的两种情况下，test.c和main.c中使用的全局变量a都还是代表着同一个变量

注意了，不可以两个文件的所有全部变量a都用extern，下面的做法是错误的：

![](https://images0.cnblogs.com/blog/497279/201303/23083426-bda17b35f43e4711b8b09b17d286bc1b.png)

![](https://images0.cnblogs.com/blog/497279/201303/23084031-df38405c7291421f9cc76a0dc3da47c0.png)

因为extern是用来声明一个已经定义过的变量，这两个文件都是在声明变量，没有人定义变量，在链接的时候肯定报错：

![](https://images0.cnblogs.com/blog/497279/201303/23084103-9d797d78ea234aeabcbab6ad5380f37e.png)

大致错误意思是：标示符a未定义

## 五、static关键字

但很多时候，我们并不想让源文件中的全局变量跟其他源文件共享，相当于私有的全局变量，那么你就得用static关键字来定义变量。

![](https://images0.cnblogs.com/blog/497279/201303/23084248-2473129a1f3141b79ccb2f13e542b86d.png)

![](https://images0.cnblogs.com/blog/497279/201303/23083051-aef0c9b3a42e46ab9f3442371877ff04.png)

这样写完，test.c和main.c的变量a分别代表着不同的变量，它们是没有联系的、互不干扰的。也就是说，main.c无法访问test.c中的变量a，因此在main.c中将a修改为10后，test.c中的a依然为0。输出结果：

![](https://images0.cnblogs.com/blog/497279/201303/22225453-8abf9d8aa8294b008367459c9798875c.png)。

 其实static还可以用来修饰局部变量，这个在《[变量类型](http://www.cnblogs.com/mjios/archive/2013/03/21/2973719.html)》中说过，不再阐述了。


* 因为main.c已经没有权限访问test.c中的变量a了，所以下面的写法是错误的：

 ![](https://images0.cnblogs.com/blog/497279/201303/23084615-55acf07a0c244a5591a1c9301e474627.png)

![](https://images0.cnblogs.com/blog/497279/201303/23084626-0cfda5589a7c48a4a800d08eeb1c47f2.png)

extern是用来声明已经定义过而且能够访问的变量，虽然test.c中有定义过变量a，但是test.c中变量a的作用域是只限于test.c文件，main.c没有访问权限，所以main.c中的extern是废的。

链接的时候报错：标示符a未定义

![](https://images0.cnblogs.com/blog/497279/201303/23084103-9d797d78ea234aeabcbab6ad5380f37e.png)

除非main.c自己定义一个变量a，这样子extern才是有效的，不过这时候main.c和test.c中的变量a是分别代表着不同变量

![](https://images0.cnblogs.com/blog/497279/201303/23085239-0668bd48e0b8425fb41ed3e3f679d128.png)

## 六、static和extern的总结

1. extern可以用来声明一个全局变量，但是不能用来定义变量
2. 默认情况下，一个全局变量是可以供多个源文件共享的，也就说，多个源文件中同名的全局变量都代表着同一个变量
3. 如果在定义全局变量的时候加上static关键字，此时static的作用在于限制该全局变量的作用域，只能在定义该全局变量的文件中才能使用，跟其他源文件中的同名变量互不干扰