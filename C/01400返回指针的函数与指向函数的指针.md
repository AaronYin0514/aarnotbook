# 返回指针的函数与指向函数的指针

## 前言

前面我们花了接近3个章节学习指针，应该都感受到指针的强大了吧。指针可以根据地址直接操作内存中的数据，使用得当的话，不仅能使代码量变少，还能优化内存管理、提升程序性能。关于指针的内容还非常多，比如指针数组、指向数组的指针、指向指针的指针，呵呵，看到这些名字是否都觉得头大了，不过我就暂时不在博客中讲解这些内容了，我只讲述在iOS开发中指针的最常见用法，比如这一章的内容----**返回指针的函数** 与 **指向函数的指针**

## 一、返回指针的函数

指针也是C语言中的一种数据类型，因此一个函数的返回值肯定可以是指针类型的。

返回指针的函数的一般形式为：

```
类型名 * 函数名(参数列表)
```

比如下面这个函数，返回一个指向char类型变量的指针

```c
// 将字符串str中的小写字母变成大写字母，并返回改变后的字符串
// 注意的是：这里的参数要传字符串变量，不能传字符串常量
char * upper(char *str) {
    // 先保留最初的地址。因为等会str指向的位置会变来变去的。
    char *dest = str;

    // 如果还不是空字符
    while (*str != '\0') {
        // 如果是小写字母
        if (*str >= 'a' && *str <= 'z') {
            // 变为大写字母。小写和大写字母的ASCII值有个固定的差值
            *str -= 'a' - 'A';
        }

        // 遍历下一个字符
        str++;
    }

    // 返回字符串
    return dest;
}
```

里面的代码我就不详细解释了，重点看第2行的定义形式。

调用这个函数也非常简单：

```c
int main()
{
    // 定义一个字符串变量
    char str[] = "lmj";
    
    // 调用函数
    char *dest = upper(str);
    
    printf("%s", dest);
    return 0;
}
```

输出结果：

![](https://images0.cnblogs.com/blog/497279/201303/19105516-7a4ae30d001945aaa1217394a0ecf10a.png)

## 二、指向函数的指针

看到这个标题，你可能觉得很诧异，指针竟然可以指向一个函数，那我就先解释一下**为什么指针可以指向一个函数**？

### 1.为什么指针可以指向一个函数？

函数作为一段程序，在内存中也要占据部分存储空间，它也有一个起始地址，即函数的入口地址。函数有自己的地址，那就好办了，我们的指针变量就是用来存储地址的。因此，可以利用一个指针指向一个函数。其中，函数名就代表着函数的地址。

### 2.指向函数的指针的定义

定义的一般形式：

```
函数的返回值类型 (*指针变量名)(形式参数1, 形式参数2, ...);
```

注意：形式参数的变量名可以省略，甚至整个形式参数列表都可以省略

```c
[[include]] <stdio.h>

int sum(int a, int b) {
    return a + b;
}

int main()
{
    // 定义一个指针变量p，指向sum函数
    int (*p)(int a, int b) = sum;
    // 或者 int (*p)(int, int) = sum;
    // 或者 int (*p)() = sum;

    // 利用指针变量p调用函数
    int result = (*p)(1, 3);
    // 或者 int result = p(1, 3);

    printf("%d", result);
    return 0;
}
```

* 首先在第3行定义了一个sum函数，接收2个int类型的参数，返回值类型为int
* 然后在第10行定义了一个指向sum函数的指针变量p。注意p的定义形式：`int (*p)(int a, int b)`，第1个int代表sum函数的返回值是int类型，然后`*p`是用括号`()`包住的，后面的`int a`和`int b`代表着`sum`函数的形参，其实完全可以省略。第10行、11行、12行都是可行
* 在第15行，先利用`*p`取出指向的函数，再传入参数调用函数。也可以采用第16行中的做法，这样就跟调用普通函数没什么区别

最后的输出结果：

![](https://images0.cnblogs.com/blog/497279/201303/19015731-cb60d5d995364fb4ba493f932365d49b.png)

毫无意外

### 3.使用注意

**1>** 由于这类指针变量存储的是一个函数的入口地址，所以对它们作加减运算(比如p++)是无意义的。难道p++就会指向下一个函数了？可笑至极！！没这回事。

**2>** 返回指针的函数的定义`char *upper(char *str)` 和 指向函数的指针的定义`int (*p)(int a, int b)`非常相似，使用时特别注意区分

**3>** 指向函数的指针变量主要有两个用途：

* 调用函数

* 将函数作为参数在函数间传递。我这么一说，可能还不是很明白，举个例子。

```c
[[include]] <stdio.h>

// 减法运算
int minus(int a, int b) {
    return a - b;
}

// 加法运算
int sum(int a, int b) {
    return a + b;
}

// 这个counting函数是用来做a和b之间的计算，至于做加法还是减法运算，由函数的第1个参数决定
void counting( int (*p)(int, int) , int a, int b) {
    int result = p(a, b);
    printf("计算结果为：%d\n", result);
}

int main()
{
    // 进行加法运算
    counting(sum, 6, 4);

    // 进行减法运算
    counting(minus, 6, 4);

    return 0;
}
```

如果以后想再增加一种乘法运算，非常简单，根本不用修改counting函数的代码，只需要再增加一个乘法运算的函数

```c
int mul(int a, int b) { 
    return a * b;
}
```

然后`counting(mul, 6, 4);`就可以进行乘法运算了