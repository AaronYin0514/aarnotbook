---
tags: [ruby, date]
---

# Time

`Time` 类用于表示时间。时间除了表示年月日时分秒的信息以外，还包含了表示地域时差的时区（time zone）信息。

## 创建

### 获取当前时间的Time对象

`new`和`now`方法创建当前时间的Time对象。

```ruby
p Time.new # 2021-09-22 09:42:43 +0800
p Time.now # 2021-09-22 09:42:43 +0800
```

### `mktime`从年/月/日/时/分/秒创建日期

```
Time.mktime`(_year_[_, month_[_,_ day[_, hour_ [_, min_[_, sec_[_, usec_]]]]]]])
```

```ruby
Time.mktime(2021, 5, 30, 13, 11, 13) # 2021-05-30 13:11:13 +0800
```

### `at`时间戳创建

```ruby
Time.at(0)                                #=> 1969-12-31 18:00:00 -0600
Time.at(Time.at(0))                       #=> 1969-12-31 18:00:00 -0600
Time.at(946702800)                        #=> 1999-12-31 23:00:00 -0600
Time.at(-284061600)                       #=> 1960-12-31 00:00:00 -0600
Time.at(946684800.2).usec                 #=> 200000
Time.at(946684800, 123456.789).nsec       #=> 123456789
Time.at(946684800, 123456789, :nsec).nsec #=> 123456789

Time.at(1582721899, in: "+09:00")         #=> 2020-02-26 21:58:19 +0900
Time.at(1582721899, in: "UTC")            #=> 2020-02-26 12:58:19 UTC
Time.at(1582721899, in: "C")              #=> 2020-02-26 13:58:19 +0300
Time.at(1582721899, in: 32400)            #=> 2020-02-26 21:58:19 +0900

require 'tzinfo'
Time.at(1582721899, in: TZInfo::Timezone.get('Europe/Kiev'))
                                          #=> 2020-02-26 14:58:19 +0200
```

### 解析字符串

使用`parse`函数必须`require 'time'`，`parse`函数可以解析多种格式的时间类型。

```ruby
require 'time'

t1 = Time.parse('2012/03/30')
p t1 # 2012-03-30 00:00:00 +0800

t2 = Time.parse('2013/03/30 03:54:15')
p t2 # 2013-03-30 03:54:15 +0800
```

## 获取时间戳

从 1970 年 1 月 1 日到当前时间的秒数

```ruby
t = Time.now
p t.to_i # 1632275206
```

## 格式化

### `to_s`

按照格式**%Y-%m-%d %H:%M:%S %z**输出

```ruby
t = Time.mktime(2021, 5, 30, 13, 11, 13)
p t.to_s # "2021-05-30 13:11:13 +0800"
```

### `strftime`

把时间转换为遵循某种格式的字符串。

```ruby
t = Time.mktime(2021, 5, 30, 13, 11, 13)
p t.strftime('%Y/%m/%d %H:%M:%S') # "2021/05/30 13:11:13"
```

**Time#strftime 中的格式字符串**

| 格式 | 意义与范围                                     |
| ---- | ---------------------------------------------- |
| `%A` | 星期的名称（`Sunday`、 `Monday`……）            |
| `%a` | 星期的缩写名称（`Sun`、 `Mon`……）              |
| `%B` | 月份的名称（`January`、 `February`……）         |
| `%b` | 月份的缩写（`Jan`、 `Feb`……）                  |
| `%c` | 日期与时间                                     |
| `%d` | 日（01 ～ 31）                                 |
| `%H` | 24 小时制（00 ～ 23）                          |
| `%I` | 12 小时制（01 ～ 12）                          |
| `%j` | 一年中的天（001 ～ 366）                       |
| `%M` | 分（00 ～ 59）                                 |
| `%m` | 表示月的数字（01 ～ 12）                       |
| `%p` | 上午或下午（AM、PM）                           |
| `%S` | 秒（00 ～ 60）                                 |
| `%U` | 表示周的数字。以星期天为一周的开始（00 ～ 53） |
| `%W` | 表示周的数字。以星期一为一周的开始（00 ～ 53） |
| `%w` | 表示星期的数字。0 表示星期天（0 ～ 6）         |
| `%X` | 时间                                           |
| `%x` | 日期                                           |
| `%Y` | 表示西历的数字                                 |
| `%y` | 西历的后两位（00 ～ 99）                       |
| `%Z` | 时区（ `JST` 等）                              |
| `%z` | 时区（+0900 等）                               |
| `%%` | 原封不动地输出 `%`                             |
| `%L` | 毫秒                                           |

## 获取年/月/日/时/分/秒

```ruby
t = Time.now
p t.year # 2021
p t.month # 9
p t.day # 22
p t.hour # 10
p t.min # 32
p t.sec # 12
```

**时间的相关方法**

| 方法名  | 意义                                  |
| ------- | ------------------------------------- |
| `year`  | 年                                    |
| `month` | 月                                    |
| `day`   | 日                                    |
| `hour`  | 时                                    |
| `min`   | 分                                    |
| `sec`   | 秒                                    |
| `usec`  | 秒以下的位数（以毫秒为单位）          |
| `wday`  | 一周中的第几天（0 表示星期天）        |
| `mday`  | 一个月中的第几天（与 `day` 方法一样） |
| `yday`  | 一年中的第几天（1 表示 1 月 1 日）    |
| `zone`  | 时区（`JST` 等）                      |

## 时间的比较

使用**比较运算符**进行时间的比较。

```ruby
t1 = Time.mktime(2021, 5, 30, 13, 11, 13)
t2 = Time.mktime(2022, 5, 30, 13, 11, 13)
p t1 >= t2 # false
```

## 时间的运算

### `-`两个时间间隔秒数

```ruby
t1 = Time.mktime(2021, 5, 30, 13, 11, 13)
t2 = Time.mktime(2021, 5, 30, 13, 11, 20)
p t1 - t2 # -7
```

### `-`减xxx秒

```ruby
t1 = Time.mktime(2021, 5, 30, 13, 11, 13)
p t1 - 10 # 2021-05-30 13:11:03 +0800
```

### `+`加xxx秒

```ruby
t1 = Time.mktime(2021, 5, 30, 13, 11, 13)
p t1 + 10 # 2021-05-30 13:11:23 +0800
```































