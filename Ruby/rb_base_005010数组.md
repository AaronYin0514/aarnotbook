---
date: 2021/8/21
tags: [ruby, array]
---
# 数组
## 定义

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]
```

## 访问

### 切片

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary[2] # "Swift"
p ary[100] # nil
p ary[-3] # "Python"

p ary[2, 3] #=> ["Swift", "Python", "Java"]
p ary[1..4] #=> ["OC", "Swift", "Python", "Java"]
p ary[1..-3] #=> ["OC", "Swift", "Python"]
```

### `at`

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary.at(2) # "Swift"
p ary.at(100) # nil
p ary.at(-3) # "Python"
```

### `fetch`

```
fetch(index) → element
fetch(index, default_value) → element
fetch(index) {|index| ... } → element
```

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary.fetch(2) # "Swift"
p ary.fetch(100, "C") # C 第二个参数是默认值
p ary.fetch(-3) { |index| "Value for #{index}"  } # "Python"
p ary.fetch(100) { |index| "Value for #{index}"  } # "Value for 100"
```

### `first` 和 `last`

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary.first # "Ruby"
p ary.last # "Javascript"
```

### `take`

返回数组前n个元素组成的新数组

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary.take(3) # ["Ruby", "OC", "Swift"]
```

### `drop`

返回数组前n个元素以外的所有元素组成的数组

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary.drop(3) # ["Python", "Java", "Javascript"]
```

## 长度

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]

p ary.size # 6
p ary.count # 6
```

## 判断是否是空数组

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java", "Javascript"]
arr = []

p ary.empty? # false
p arr.empty? # true
```

## 添加元素

### 数组末尾添加一个元素

```ruby
ary = ["Ruby", "OC", "Swift", "Python", "Java"]
p ary # "Ruby", "OC", "Swift", "Python", "Java"]
ary << "JavaScript"
p ary # ["Ruby", "OC", "Swift", "Python", "Java", "JavaScript"]
```

### `push`数组末尾添加一个或多个元素

```ruby
ary = ["Ruby", "OC", "Swift"]
p ary # ["Ruby", "OC", "Swift"]
ary.push("Java")
p ary # ["Ruby", "OC", "Swift", "Java"]
ary.push("Python", "JavaScript")
p ary # ["Ruby", "OC", "Swift", "Java", "Python", "JavaScript"]
```

### `unshift`数组头部插入一个或多个元素

```ruby
ary = ["Ruby", "OC", "Swift"]
p ary # ["Ruby", "OC", "Swift"]
ary.unshift("Java")
p ary # ["Java", "Ruby", "OC", "Swift"]
ary.unshift("Python", "JavaScript")
p ary # ["Python", "JavaScript", "Java", "Ruby", "OC", "Swift"]
```

###	`insert`插入一个或多个元素到指定索引位置

```ruby
ary = ["Ruby", "OC", "Swift"]
p ary # ["Ruby", "OC", "Swift"]
ary.insert(1, "Java")
p ary # ["Ruby", "Java", "OC", "Swift"]
ary.insert(2, "Python", "JavaScript")
p ary # ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]
```

## 删除元素

### `pop`删除数组末尾元素 `pop(n)`删除数组末尾n个元素

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]
p ary # ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

p ary.pop # "Swift"
p ary # ["Ruby", "Java", "Python", "JavaScript", "OC"]

p ary.pop(3) # ["Python", "JavaScript", "OC"]
p ary # ["Ruby", "Java"]
```

### `shift`删除数组头部元素 `shift(n)`删除数组头部n个元素

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]
p ary # ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

p ary.shift # "Ruby"
p ary # ["Java", "Python", "JavaScript", "OC", "Swift"]

p ary.shift(3) # ["Java", "Python", "JavaScript"]
p ary # ["OC", "Swift"]
```

### `delete_at`删除指定位置的元素 

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]
p ary # ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

p ary.delete_at(3) # "JavaScript"
p ary # ["Ruby", "Java", "Python", "OC", "Swift"]
```

### `compact`删除数组中的nil

`compact`

```ruby
ary = ["Ruby", nil, "Python", "JavaScript", nil, nil]
p ary # ["Ruby", nil, "Python", "JavaScript", nil, nil]

newAry = ary.compact
p newAry # ["Ruby", "Python", "JavaScript"]
```

`compact!`

```ruby
ary = ["Ruby", nil, "Python", "JavaScript", nil, nil]
p ary # ["Ruby", nil, "Python", "JavaScript", nil, nil]

ary.compact!
p ary # ["Ruby", "Python", "JavaScript"]
```

### `uniq`删除数组中重复的元素

`uniq` 与 `uniq!`

默认使用`eql?`方法比较元素

```ruby
ary = ["Ruby", "Ruby", "Python", "Python"]
p ary # ["Ruby", "Ruby", "Python", "Python"]

newAry = ary.uniq
p newAry # ["Ruby", "Python"]

newAry2 = ary.uniq!
p ary # ["Ruby", "Python"]
```

指定比较方法

```ruby
a = ['a', 'aa', 'aaa', 'b', 'bb', 'bbb']
p a.uniq {|element| element.size } # => ["a", "aa", "aaa"]
```

```ruby
a = ['a', 'aa', 'aaa', 'b', 'bb', 'bbb']
a.uniq! {|element| element.size } # => ['a', 'aa', 'aaa']
```

## 修改元素

```ruby
ary = ["Ruby", "Python"]
ary[0] = "ruby"
ary[1] = "python"
p ary # ["ruby", "python"]
```

## 遍历

### for in

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

for element in ary do
  p element
end
```

### `each`遍历数组

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

ary.each { |element| p element }
```

### `reverse_each`倒序遍历数组

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

ary.reverse_each { |element| p element }
```

### `each_index`遍历索引

```ruby
a = [:foo, 'bar', 2]
a.each_index {|index|  puts "#{index} #{a[index]}" }
```

## 查找元素

### 判断某元素在元素中是否存在?

```ruby
ary = ["Ruby", "Python"]
p ary.include?("Ruby") # true
p ary.include?("C++") # false
```

### `index`查找某元素的索引

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

p ary.index("Python") # 2
p ary.index("C++") # nil

p ary.index { |e| e.start_with?("Java") } # 1
p ary.index { |e| e.start_with?("C") } # nil
```

### `select`选择符合条件的元素 `reject`排除符合条件的元素

```ruby
ary = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]

# select
p ary.select { |e| e.start_with?("Java") } # ["Java", "JavaScript"]

# reject
p ary.reject { |e| e.start_with?("Java") } # ["Ruby", "Python", "OC", "Swift"]
```

```ruby
# select!
ary1 = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]
ary1.select! { |e| e.start_with?("Java") } 
p ary1 # ["Java", "JavaScript"]

# reject!
ary2 = ["Ruby", "Java", "Python", "JavaScript", "OC", "Swift"]
ary2.reject! { |e| e.start_with?("Java") } 
p ary2 # ["Ruby", "Python", "OC", "Swift"]
```

## 数组组合

### `&` 返回数组交集，去除重复元素

```ruby
p [0, 1, 2, 3] & [1, 2] # => [1, 2]
p [0, 1, 2] & [3, 2, 1, 0] # => [0, 1, 2]
```

### `|`返回数组并集，去除重复元素

```ruby
x = [1, 1, 2, 4]
y = [1, 2, 2, 2]

x | y  # => [1, 2, 4]
```

### `*`

`array * n → new_array` n是整数，返回n个副本构建的新数组

```ruby
a = ['x', 'y']
p a * 3 # => ["x", "y", "x", "y", "x", "y"]
```

`array * string_separator → new_string` *一个字符串，相当于`join`

```ruby
p [0, [0, 1], {foo: 0}] * ', ' # => "0, 0, 1, {:foo=>0}"
```

### `+`

```ruby
a = [0, 1] + [1, 2, 3]
p a # => [0, 1, 1, 2, 3]
```

### `-`

`array - other_array → new_array`返回**other_array**中**找不到**的元素

```ruby
p [0, 1, 1, 2, 2, 3, 1] - [1] # => [0, 2, 2, 3]
p [0, 1, 2, 3] - [3, 0] # => [1, 2]
p [0, 1, 2] - [4] # => [0, 1, 2]
```

## 数组转字符串

### `join`

默认分隔符`$,`，`$,`默认值`nil`。所以默认将数组元素直接拼接

```ruby
a = [:foo, 'bar', 2]
p $, # => nil
p a.join # => "foobar2"
```

指定分隔符

```ruby
ary = ["Ruby", "Java", "Python"]
p ary.join(",") # "Ruby,Java,Python"
```

转换字符串时，如果元素的类型不是数组，则调用`to_s`方法。如果是数组，则递归调用`join`方法

```ruby
a = [:foo, [:bar, [:baz, :bat]]]
p a.join # => "foobarbazbat"
```

## 拷贝

## `map`

修改原数组中的每个元素，并返回新的数组

```ruby
ary = [1, 2, 3]
p ary.map{ |e| e ** 2 } # [1, 4, 9]

ary.map!{ |e| e ** 2 }
p ary # [1, 4, 9]
```

## `flatten`

```
flatten → new_array
flatten(level) → new_array
```

递归展平数组，并可以指定级别

```ruby
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten(0) # => [0, [1, [2, 3], 4], 5]
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten(1) # => [0, 1, [2, 3], 4, 5]
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten(2) # => [0, 1, 2, 3, 4, 5]
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten(3) # => [0, 1, 2, 3, 4, 5]
```

如果不传参数、nil或负数，会展平所有级别

```ruby
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten # => [0, 1, 2, 3, 4, 5]
p [0, 1, 2].flatten # => [0, 1, 2]
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten(-1) # => [0, 1, 2, 3, 4, 5]
a = [ 0, [ 1, [2, 3], 4 ], 5 ]
p a.flatten(-2) # => [0, 1, 2, 3, 4, 5]
p [0, 1, 2].flatten(-1) # => [0, 1, 2]
```

`flatten!`会修改原数组

```ruby
flatten! → self or nil
flatten!(level) → self or nil
```

## `sort`排序

```ruby
a = ["a", "c", "b", "d"]
p a.sort # ["a", "b", "c", "d"] 默认生序
p a.sort {|a, b| b <=> a } # ["d", "c", "b", "a"] 降序
```

`sort!`会改变原数组

```ruby
a = ["a", "c", "b", "d"]
a.sort!
p a# ["a", "b", "c", "d"]
```

## 反转

```ruby
a = ['foo', 'bar', 'two']
p a.reverse # => ["two", "bar", "foo"]

a.reverse! 
p a # => ["two", "bar", "foo"]
```
